package ca.csf.mobile2.tp2.question

import android.annotation.SuppressLint
import android.support.design.widget.Snackbar
import android.support.v7.app.AppCompatActivity
import ca.csf.mobile2.tp2.R
import ca.csf.mobile2.tp2.databinding.ActivityCreateQuestionBinding
import org.androidannotations.annotations.*

@SuppressLint("Registered") //Reason : Generated by Android Annotations
@DataBound
@EActivity(R.layout.activity_create_question)
class CreateQuestionActivity : AppCompatActivity() {

    @Bean
    protected lateinit var questionService: CreateQuestionService

    @InstanceState
    protected lateinit var question: Question

    @InstanceState
    protected lateinit var viewModel: CreateQuestionActivityViewModel

    protected fun onCreate(@BindingObject dataBinder: ActivityCreateQuestionBinding) {
        if (!this::question.isInitialized)
            question = Question()
        if (!this::viewModel.isInitialized)
            viewModel = CreateQuestionActivityViewModel()

        dataBinder.viewModel = viewModel
    }

    @Click(R.id.createQuestionButton)
    protected fun onPostButtonClick() {
        if (viewModel.questionText != "" && viewModel.choice1 != "" && viewModel.choice2 != "") {
            question = Question(
                question.id, viewModel.questionText, viewModel.choice1,
                viewModel.choice2, question.nbChoice1, question.nbChoice2
            )
            questionService.postQuestion(
                question,
                this::onQuestionPost,
                this::onConnectivityError,
                this::onServerError
            )
        }
    }

    @UiThread
    protected fun onQuestionPost() {
        Snackbar.make(findViewById(R.id.root_view), "Question sent", Snackbar.LENGTH_LONG).show()
    }

    @UiThread
    protected fun onConnectivityError() {
        Snackbar.make(findViewById(R.id.root_view), R.string.text_error_internet, Snackbar.LENGTH_LONG).show()
    }

    @UiThread
    protected fun onServerError() {
        Snackbar.make(findViewById(R.id.root_view), R.string.text_error_server, Snackbar.LENGTH_LONG).show()
    }
}